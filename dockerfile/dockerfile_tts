# Utiliser une image avec PyTorch déjà installé
FROM pytorch/pytorch:2.0.0-cuda11.7-cudnn8-runtime

# Définir le dossier de travail
WORKDIR /app

# Installer git et les dépendances système nécessaires
RUN apt-get update && apt-get install -y git && rm -rf /var/lib/apt/lists/*

# Copier uniquement les fichiers nécessaires
COPY requirements.txt .

# Installer les dépendances (avec cache)
RUN pip install --upgrade pip \
 && pip install --no-cache-dir -r requirements.txt

# Installer Tortoise TTS (sans dépendances, pour éviter conflit avec torch)
RUN pip install tokenizers==0.14.0
RUN pip install transformers==4.31.0 --no-deps
RUN pip install git+https://github.com/neonbjb/tortoise-tts.git --no-deps

# Copier le reste du code
COPY . .

# Exposer le port utilisé par le service TTS (si applicable)
EXPOSE 6000

# Lancer ton service — à adapter selon ton script principal
#CMD ["python", "main.py"]